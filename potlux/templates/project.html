{% extends "template.html" %}
{% block title %}Project{% endblock %}
{% block head %}
  {{ super() }}
  <style type="text/css">
    .important { color: #336699; }
  </style>
{% endblock %}

{% block content %}

    <div class="content about">
      <div class="projectName">
      {{idea.name}}
      </div>
      <table border="0">
        <tr>
          <td>
            <span class="projectTitle">
            INITIATIVE NAME
            </span>
          </td>
          <td>
            <span class="projectInfo">
            {{idea.name}}
            </span>
          </td>
        </tr>
        <tr>
          <td>
            <span class="projectTitle">
            UNIVERSITY
            </span>
          </td>
          <td>
            <span class="projectInfo">
            {{titleize(idea.university)}}
            </span>
          </td>
        </tr>
        <tr>
          <td>
            <span class="projectTitle">
            CATEGORY
            </span>
          </td>
          <td>
            <span class="projectInfo">
            {% for category in idea.categories: %}
              <a href="{{ url_for('search', tag=category) }}">{{category}}</a>,
            {% endfor %}
            </span>
          </td>
        </tr>
        <tr>
          <td>
            <span class="projectTitle">
            CONTACT
            </span>
          </td>
          <td>
            <span class="projectInfo">
            {{idea.contact.name}} &lt;<a class="projLink" href="mailto:{{idea.contact.email}}">{{idea.contact.email}}</a>&gt;
            </span>
          </td>
        </tr>
      </table>
      <br />
      <br />

      {% if len(idea.resources.images) > 0 %}
      <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
        <!-- Indicators -->
        <ol class="carousel-indicators">
          {% for i in range(len(idea.resources.images)): %}
          {% if i == 0: %}
          <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
          {% else %}
          <li data-target="#carousel-example-generic" data-slide-to="{{i}}"></li>
          {% endif %}
          {% endfor %}
        </ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner" role="listbox">
          {% for image_url in idea.resources.images: %}
          {% if loop.index == 1: %}
          <div class="item active">
          {% else %}
          <div class="item">
          {% endif %}
            <img class="caroImage" src="{{ url_for('static', filename=image_url) }}">
          </div>
          {% endfor %}
        </div>

        <!-- Controls -->
        <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
          <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
          <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
      {% endif %}

      <br />
      <br />
      <div class="summaryTitle">
      SUMMARY
      </div>
      <div class="projectSummary">
      {{idea.summary}} <span id="editButt"><a onClick="editSummary()" href="#" class="projLink">&nbsp;&nbsp;edit</a></span>
      </div>
      <br /><br />
      <div>
          <form action="/idea/{{idea._id}}" method="post" enctype=multipart/form-data>
            <input type="file" name="imageUpload" />
            <input type="submit" name="submit" />
          </form>
      </div>
    </div>


    <script>
      function editSummary(){
        var curSum = document.getElementById('ideaWords').innerHTML;
        document.getElementById('ideaWords').innerHTML = "<textarea id=\"tarea\" rows=\"4\"cols=\"50\">" + curSum + "</textarea>";
        document.getElementById('editButt').innerHTML = "<a onClick=\"changeSummary()\" href=\"#\">done</a>";
      }

      function changeSummary(){
        var newSum = document.getElementById('tarea').value;
        post('/idea/{{idea._id}}', newSum);
      }

      function post(path, newSum) {

        var form = document.createElement("form");
        form.setAttribute("method", "post");
        form.setAttribute("action", path);

        var hiddenField = document.createElement("input");
        hiddenField.setAttribute("type", "hidden");
        hiddenField.setAttribute("name", "summary");
        hiddenField.setAttribute("value", newSum);

        form.appendChild(hiddenField);

        document.body.appendChild(form);
        form.submit();
    }

    var true_width = ( function(){
      var $tempobj = $('#projImages') // starting with truncated text div projImages
          .clone().contents() // duplicate the text
          .wrap('<div id="content"/>') // wrap it in a projImages
          .parent().appendTo('body') // add this to the dom
          .css('left','-1000px'); // but put it far off-screen
      var result = $tempobj.width(); // measure it
      $tempobj.remove(); // clean up
      return result;
    })();

    $('#projImages').one('mouseenter', function(){ // perhaps trigger once only
      var shift_distance = true_width - $(this).width(); // how far to move
      var time_normalized = parseInt(shift_distance / 100, 10) * 1000; // speed
      $(this).contents().wrap('<div id="content">').parent() // wrap in div
        .animate({
            left: -shift_distance,
            right: 0
        }, time_normalized, 'linear'); // and move the div within its "viewport"
    });
    </script>
{% endblock %}