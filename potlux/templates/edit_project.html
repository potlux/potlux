{% extends "template.html" %}
{% set active_page = "project" %}
{% block title %}Project{% endblock %}
{% block head %}
  {{ super() }}
  <style type="text/css">
    .important { color: #336699; }
  </style>
  <script src="http://js.nicedit.com/nicEdit-latest.js" type="text/javascript"></script>
<script type="text/javascript">bkLib.onDomLoaded(nicEditors.allTextAreas);</script>

{% endblock %}

{% from "_templatehelpers.html" import render_project_edit_field, render_project_info %}

{% block content %}

	<div class="content about">
      {{ render_project_info(idea, current_user._id in idea.owners, True) }}
      <br />
      <br />

	 {% if len(idea.resources.images) > 0 %}
      <div class="images">
      {% for image_url in idea.resources.images: %}
        <img src="{{ url_for('static', filename=image_url.full_size) }}" height="150" class="clickbl"/>
      {% endfor %}
      </div>


      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body">
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    {% endif %}

      <br/>
      <br/>
      <div class="projectSummary" style="font-size:24px;font-weight:200;">
        Add Images of your Project
      </div>
      <div style="font-size:8px;line-height:8px;">
            &nbsp;
            </div>
      <div class="textBlock" style="width:250px;overflow:hidden;">
          <form action="/idea/edit/{{idea._id}}" method="post" enctype=multipart/form-data>
            <input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />
            <input type="file" name="imageUpload" />
            <div style="font-size:10px;line-height:10px;">
            &nbsp;
            </div>
            <input type="submit" name="submit" class="subButton" value="Upload">
          </form>
      </div><br /><br />

      <form method="POST" action="/idea/edit/{{ idea_id }}">
      	<input type="hidden" name="_csrf_token" value="{{ csrf_token() }}" />
    		{{ render_project_edit_field("summary", idea.summary, leading_qs['summary']) }}
    		{{ render_project_edit_field("impact", idea.impact, leading_qs['impact']) }}
    		{{ render_project_edit_field("procedure", idea.procedure, leading_qs['procedure']) }}
    		{{ render_project_edit_field("mistakes & lessons learned", idea.results, leading_qs['mistakes & lessons learned']) }}
    		{{ render_project_edit_field("future plans", idea.future, leading_qs['future plans']) }}
    		<input type="submit" name="submit" class="subButton" value="Save Changes"/ style="width:130px">
      </form>


      <br/><br/><br/>

      <script>
        $(function() {
          $('.remove-category-icon').click(function() {
            var base_url = "{{ url_for('edit_project_tag', project_id=idea._id) }}"
            var delete_url = base_url + "?del_cat=" + $(this).attr('data-cat');
            console.log(delete_url);
            $.ajax({
              url: delete_url,
              method: "DELETE",
              success: function() {
                location.reload();
              }
            });
          });

          $('.remove-website-icon').click(function() {
            var base_url = "{{ url_for('edit_project_website', project_id=idea._id) }}"
            var delete_url = base_url + "?del_site=" + $(this).attr('data-site');
            console.log(delete_url);
            $.ajax({
              url: delete_url,
              method: "DELETE",
              success: function() {
                location.reload();
              }
            });
          });

          $('.remove-contact-icon').click(function() {
            var base_url = "{{ url_for('edit_project_contacts', project_id=idea._id) }}";
            var delete_url = base_url + "?del_email=" + encodeURIComponent($(this).attr('data-contact'));
            console.log(delete_url);
            $.ajax({
              url: delete_url,
              method: "DELETE",
              success: function() {
                location.reload();
              }
            });
          });

          $('#add-contact').click(function() {
            email_input.appendTo(email_form);
            // var popup_div = $('<div></div>').css({
            //   'width': '400px',
            //   'height': '200px',
            //   'position': 'absolute',
            //   'top': '30vh',
            //   'left': '30%', 
            //   'background-color': '#DDDDDD',
            //   'box-shadow': '2px 2px 5px #A9A9A9',
            //   'z-index': '100'
            //   });
            // popup_div.append('<input />').attr('id', 'new_email');
            // popup_div.append()
            $('body').append(email_form);
          });
        });
      </script>

{% endblock %}